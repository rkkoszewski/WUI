{"name":"WUI Element Editor","version":"1.0.0","html":"<div class=\"vertical\">\n\t<!-- Element Information and Dependencies -->\n\t<div class=\"horizontal card-container\" style=\"min-width: 200px;\"> <!-- Left  Side-->\n\t\t<div class=\"editor card fit_content\"> <!-- Element Information -->\n\t\t\t<h3>Information</h3>\n\t\t\t<div class=\"data_element\">Name: <input type=\"text\" wui-ref=\"element_name\" value=\"Example\"/></div>\n\t\t\t<div class=\"data_element\">Version: <input type=\"text\" wui-ref=\"element_version\" value=\"1.0.0\"/></div>\n\t\t</div> \n\t\t<div class=\"editor card\"> <!-- Element Dependencies -->\n\t\t\t<h3>Dependencies</h3>\n\t\t\t<div class=\"dependency_element\"> <!-- New Dependency -->\n\t\t\t\t<select wui-ref=\"add_dependency_type\">\n\t\t\t\t\t<option value=\"js\">JS</option>\n\t\t\t\t\t<option value=\"css\">CSS</option>\n\t\t\t\t</select>\n\t\t\t\t<input wui-ref=\"add_dependency_name\" type=\"text\" placeholder=\"ID\"/>\n\t\t\t\t<input wui-ref=\"add_dependency_version\" type=\"text\" placeholder=\"Version\"/>\n\t\t\t\t<button wui-ref=\"add_dependency\">Add</button>\n\t\t\t</div>\n\t\t\t<div wui-ref=\"dependency_list\"> <!-- Current Dependencies -->\n\t\t\t\n\t\t\t</div>\n\t\t</div> \n\t</div> \n\t<!-- General Styling and Design Column -->\n\t<div class=\"horizontal card-container\" style=\"min-width: 500px;\"> <!-- Left  Side-->\n\t\t<div class=\"editor card\"> <!-- HTML Editor-->\n\t\t\t<h3>HTML</h3>\n\t\t\t<textarea wui-ref=\"element_html\"></textarea>\n\t\t</div> \n\t\t<div class=\"editor card\"> <!-- HTML Editor -->\n\t\t\t<h3>CSS <span wui-ref=\"cssErrorLog\" class=\"error_log\"></span></h3>\n\t\t\t<textarea wui-ref=\"element_css\"></textarea>\n\t\t</div> \n\t</div> \n\t<!-- Javascript Column -->\n\t<div class=\"horizontal card-container\" style=\"min-width: 500px;\"> <!-- Left  Side-->\n\t\t<div class=\"editor card\"> <!-- JS: Element Initialize Before added to DOM -->\n\t\t\t<h3>JS: Element-Initialize-Before <span wui-ref=\"jsElementInitializeBeforeErrorLog\" class=\"error_log\"></span></h3>\n\t\t\t<textarea wui-ref=\"element_initialize_before_js\"></textarea>\n\t\t</div> \n\t\t<div class=\"editor card\"> <!-- JS: Element Initialize After added to DOM-->\n\t\t\t<h3>JS: Element-Initialize-After <span wui-ref=\"jsElementInitializeAfterErrorLog\" class=\"error_log\"></span></h3>\n\t\t\t<textarea wui-ref=\"element_initialize_after_js\"></textarea>\n\t\t</div> \n\t\t<div class=\"editor card\"> <!-- JS: Element Set Data -->\n\t\t\t<h3>JS: Element-Set-Data <span wui-ref=\"jsSetDataErrorLog\" class=\"error_log\"></span></h3>\n\t\t\t<textarea wui-ref=\"element_set_data_js\"></textarea>\n\t\t</div> \n\t</div> \n\t<!-- Preview Column -->\n\t<div class=\"horizontal card-container\" style=\"min-width: 500px;\">\n\t\t<div class=\"card grow\"><!-- Preview Container -->\n\t\t\t<h3>PREVIEW</h3>\n\t\t\t<div class=\"preview_container padding\"> <!-- Right Side -->\n\t\t\t\t<div class=\"preview\" wui-ref=\"preview\">PREVIEW</div>\n\t\t\t</div> \n\t\t</div> \n\t\t<!-- Data Container -->\n\t\t<div class=\"card\">\n\t\t\t<h3>TEST DATA</h3>\n\t\t\t<div wui-ref=\"testData\"></div>\n\t\t</div>\n\t</div>\n</div>","css":{"format":"lesscss","style":"display: flex;\nheight: 100%;\nwidth: 100%;\n\n.padding {\n  box-sizing: border-box;\n  padding: 16px;\n}\n\n.card-container:last-child {\n  padding-right: 16px;\n}\n\n.card-container {\n  padding: 16px 0 0 16px;\n}\n\n.horizontal, .editor, .preview_container{\n  display: flex;\n  width: 100%;\n  flex: 1;\n  flex-direction: column;\n}\n\n.preview_container{\n  overflow: auto;\n}\n\n.vertical{\n  display: flex;\n  width: 100%;\n  flex: 1;\n}\n\n.card{\n  box-shadow: 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);\n  margin-bottom: 16px;\n  display: flex;\n  flex-direction: column;\n}\n\n.card > h3{\n  margin: 0;\n  background-color: #607D8B;\n  padding: 16px;\n  color: white;\n  transition: background-color 0.2s ease-in-out;\n}\n\n.card > h3.error{\n  background-color: #8b6060;\n}\n\n.grow{\n  flex-grow: 1;\n}\n\n.editor > .CodeMirror{\n  width: 100%;\n  flex-grow: 1;\n}\n\n.preview_container{\n  flex-grow: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.data_element{\n  padding-bottom: 6px;\n  display: flex;\n  font-weight: 900;\n  padding: 6px;\n  background-color: #f7f7f8;\n  border-bottom: 1px solid #dddddd;\n}\n\n.data_element > input{\n  min-width: 20px;\n}\n\n.data_element > input{\n  flex-grow: 1;\n  margin-left: 6px;\n}\n\n.dependency_element{\n  padding: 6px;\n  display: flex;\n  font-weight: 900;\n  background-color: #f7f7f8;\n  border-bottom: 1px solid #dddddd;\n}\n\n.dependency_element.single{\n  background-color: #fff;\n}\n\n.dependency_element.single.modified{\n  background-color: #e2afaf;\n}\n\n.dependency_element > input{\n  min-width: 20px;\n  flex-grow: 1;\n}\n\n.error_log{\n  color: #ff8383;\n  font-weight: 500;\n  font-size: 12px;\n}\n\n.fit_content{\n  max-height: fit-content;\n}"},"js":{"set-data":"// Set Element Data\nif(typeof data !== 'undefined' && data.definition && shared.getElementDefinition(true) !== data.definition){\n\tshared.setElementDefinition(data.definition);\n}","initialize-after":"var data = {}\n\nvar dependency_list = ref['dependency_list'];\nfunction buildDependencyList(elementDefinition){\n  if(typeof elementDefinition.dependencies === 'undefined') return; // Stop if dependencies is undefined\n  dependency_list.innerHTML = ''; // Clear Node\n\n  // Process JS\n  if(typeof elementDefinition.dependencies.js !== 'undefined'){\n    Object.keys(elementDefinition.dependencies.js).forEach(function(id) { // Iterate Child Node Containers\n      dependency_list.appendChild(buildDependencyElement(id, 'js', elementDefinition));\n    });\n  }\n\n  if(typeof elementDefinition.dependencies.css !== 'undefined'){\n    Object.keys(elementDefinition.dependencies.css).forEach(function(id) { // Iterate Child Node Containers\n      dependency_list.appendChild(buildDependencyElement(id, 'css', elementDefinition));\n    });\n  }\n}\n\nfunction setClassName(enable, className, node){\n  if(enable)\n    node.classList.add(className);\n  else\n    node.classList.remove(className);\n}\n\nfunction buildDependencyElement(id_value, type_value, elementDefinition){\n  var version_value = elementDefinition.dependencies[type_value][id_value].version;\n  var root = document.createElement('div');\n  root.className = 'dependency_element single';\n\n  root.dependencyData = {};\n\n  var type = document.createElement('div');\n  type.innerText = type_value.toUpperCase() + ' ';\n  root.appendChild(type);\n\n  var id = document.createElement('input');\n  id.type = 'text';\n  id.value = id_value;\n  root.dependencyData.id = id_value;\n  id.addEventListener('input', function(e){\n    setClassName(root.dependencyData.id !== id.value || root.dependencyData.version !== version.value, 'modified', root);\n  });\n  root.appendChild(id);\n\n  var version = document.createElement('input');\n  version.type = 'text';\n  version.value = version_value;\n  root.dependencyData.version = version_value;\n  version.addEventListener('input', function(e){\n    setClassName(root.dependencyData.id !== id.value || root.dependencyData.version !== version.value, 'modified', root);\n  });\n  root.appendChild(version);\n\n  var update = document.createElement('button');\n  update.innerText = '+';\n  update.title = 'Update';\n  root.appendChild(update);\n  update.onclick = function(){\n    if(id.value.trim() === '') return;\n    delete elementDefinition.dependencies[type_value][root.dependencyData.id]; // Remove Dependency\n    elementDefinition.dependencies[type_value][id.value] = {\n      version: version.value\n    }; // Set New Dependency\n    root.dependencyData.id = id.value;\n    root.dependencyData.version = version.value\n    buildDependencyList(elementDefinition); // Update Dependencies\n    createElement(); // Create Preview Element\n    sendUpdates();\n  }\n\n  var remove = document.createElement('button');\n  remove.innerText = 'X';\n  remove.title = 'Remove';\n  remove.onclick = function(){\n    delete elementDefinition.dependencies[type_value][root.dependencyData.id]; // Remove Dependency\n    buildDependencyList(elementDefinition); // Update Dependencies\n    createElement(); // Create Preview Element\n    sendUpdates();\n  }\n  root.appendChild(remove);\n\n  return root;\n}\n\nfunction buildTestDataElements(data, element, onInputCallback){\n  var ref = element._debugAccessedData;\n  var node = document.createElement('div');\n  // console.debug(element.autoDataRefrences);\n\n  Object.keys(ref).forEach(function(data_id) {\n\n    var container = document.createElement('div');\n    container.className = 'data_element';\n    container.innerText = data_id + ': ';\n\n    var dataInput = document.createElement('input');\n    dataInput.type = 'text';\n    dataInput.value = (typeof data[data_id] !== 'undefined' ? data[data_id] : '');\n    dataInput.oninput = function(){\n      data[data_id] = dataInput.value;\n      onInputCallback();\n    };\n    container.appendChild(dataInput);\n\n    node.appendChild(container);\n  });\n\n  // Append Node\n  emptyNode(testData);\n  testData.appendChild(node);\n  return node;\n}\n\nfunction emptyNode(node){\n  while (node.firstChild) {\n    node.removeChild(node.firstChild);\n  }\n}\n\n// Second Part\n\nvar preview = ref['preview'];\n\nvar testData = ref['testData'];\nvar cssErrorLog = ref['cssErrorLog'];\n\nvar jsElementInitializeBeforeErrorLog = ref['jsElementInitializeBeforeErrorLog'];\nvar jsElementInitializeAfterErrorLog = ref['jsElementInitializeAfterErrorLog'];\nvar jsSetDataErrorLog = ref['jsSetDataErrorLog'];\n\n// State Variables\nvar elementPreventUpdate = false;\n\n// Current Element Definition\nvar elementDefinition = {\n\tname: 'Example',\n\tversion: '1.0.0',\n\thtml: '',\n\tcss: {\n\t\tformat: 'lesscss',\n\t\tstyle: ''\n\t},\n\tjs:{\n\t\t'initialize-before': '',\n\t\t'initialize-after': '',\n\t\t'set-data': ''\n\t},\n\t/*dependencies:{ // TODO: To be implemented\n\t\t'js': {\n\t\t\t'jquery': {\n\t\t\t\tversion: '3.3.1',\n\t\t\t\tpriority: 1, // Loading Priority (Future)\n\t\t\t\tstrict: true // If set to false, will not throw an error when not loaded\n\t\t\t}\n\t\t},\n\t\t'css': {\n\t\t\t// ...\n\t\t}\n\t\t\n\t}*/\n}\n\nvar preview_element;\n\n// Update Element Data\nfunction updateElement(){\n\t// console.debug(\"UPDATING ELEMENT DATA\", preview.firstChild);\n\tpreview_element.setAutoData(data); // Update Auto Data\n\tpreview_element.setData(data); // Update Data\n}\n\n// Dummy Node\nfunction createDummyNode(id){\n\tvar node = document.createElement('div');\n\tnode.innerText = 'Dummy Node for ID: ' + id;\n\tnode.style.backgroundColor = 'blue';\n\tnode.style.color = 'yellow';\n\tnode.style.padding = '3px';\n\treturn node;\n}\n\n// Run Callback and Catch Error\nfunction runCatch(object, method, data, error_node){\n\tvar parent = error_node.parentNode;\n\ttry{\n\t\tobject[method](data); \n\t\tparent.classList.remove('error');\n\t\terror_node.innerText = '';\n\t}catch(e){\n\t\tconsole.error(e.stack);\n\t\tparent.classList.add('error');\n\t\terror_node.innerText = e;\n\t}\n}\n\n// Create Element (From Zero)\nfunction createElement(){\n\temptyNode(preview);\n\t\n\tpreview_element = new WUIElement(elementDefinition, { // Generate WUI Element\n\t\tdata: data,\n\t\tdebug: true,\n\t\tdebugCompileCSSSuccess: function(){\n\t\t\tcssErrorLog.parentNode.classList.remove('error');\n\t\t\tcssErrorLog.innerText = '';\n\t\t},\n\t\tdebugCompileCSSFail: function(error){\n\t\t\tcssErrorLog.parentNode.classList.add('error');\n\t\t\tcssErrorLog.innerText = error;\n\t\t},\n\t\tplaceholder: 'Loading Preview Element...'\n\t}); \n\t\n\t// Append Node to DOM with a Placeholder Node\n\tpreview.appendChild(preview_element.getNode()); // Append Child Node\n\t\n\t// Load Dependencies\n\tpreview_element.loadDependencies()\n\t.success(function(){\n\t\trunCatch(preview_element, 'initializeBefore', undefined, jsElementInitializeBeforeErrorLog); // Initialize Before\n\t\t// preview.appendChild(preview_element.getNode()); // Append Child Node (No placeholder node generated)\n\t\trunCatch(preview_element, 'initializeAfter', undefined, jsElementInitializeAfterErrorLog); // Initialize After\n\t\t// preview_element.setAutoData(data); // Set Auto Data (Only necesary when no data was provided during \"new WUIElement\")\n\t\trunCatch(preview_element, 'setData', data, jsSetDataErrorLog) // Set Data\n\t\t\n\t\t// Set Child Nodes\n\t\tconsole.debug(\"CHILD NODE CONTAINERS\", preview_element.childNodeContainers);\n\t\t\n\t\tvar childNodeContainer = preview_element.childNodeContainers;\n\t\tObject.keys(childNodeContainer).forEach(function(id) { // Iterate Child Node Containers\n\t\t\tchildNodeContainer[id].appendChild(createDummyNode(id));\n\t\t});\n\n\t\tconsole.debug(preview_element)\n\t\t\n\t\t// Build Test Data Elements\n\t\tbuildTestDataElements(data, preview_element, updateElement); // Build Test Data Editor\n\t})\n\t.fail(function(){\n\t\t// TODO: Replace Element with failed to load node message node\n\t\talert(\"FAIL\");\n\t});\n}\n\n// Element Name\nvar element_name_node = ref['element_name'];\nelement_name_node.addEventListener('input', function(e){\n\telementDefinition.name = element_name_node.value;\n\tsendUpdates();\n});\nelementDefinition.name = element_name_node.value;\n\n// Element Version\nvar element_version_node = ref['element_version'];\nelement_version_node.addEventListener('input', function(e){\n\telementDefinition.version = element_version_node.value;\n\tsendUpdates();\n});\nelementDefinition.version = element_version_node.value;\n\n// Element Dependencies\nvar add_dependency_node = ref['add_dependency'];\nvar add_dependency_name_node = ref['add_dependency_name'];\nvar add_dependency_version_node = ref['add_dependency_version'];\nvar add_dependency_type_node = ref['add_dependency_type'];\nadd_dependency_node.onclick = function(){\n\tif(add_dependency_name_node.value.trim() === '') return;\n\t\n\tif(typeof elementDefinition.dependencies === 'undefined'){\n\t\telementDefinition.dependencies = {};\n\t}\n\n\tvar type = add_dependency_type_node.value;\n\t\n\tif(typeof elementDefinition.dependencies[type] === 'undefined') elementDefinition.dependencies[type] = {};\n\t\n\t// Add Dependency Value\n\telementDefinition.dependencies[type][add_dependency_name_node.value] = {\n\t\t\tversion: add_dependency_version_node.value\n\t}\n\n\t// Reset Values\n\tadd_dependency_name_node.value = '';\n\tadd_dependency_version_node.value = '';\n\t\n\t// Rebuild Dependency List\n\tbuildDependencyList(elementDefinition);\n\t\n\t// Reload Element\n\tcreateElement();\n  \tsendUpdates();\n}\n\n// HTML Editor\nvar editor_html = CodeMirror.fromTextArea(ref['element_html'], {\n\tlineNumbers: true,\n\tmode: 'text/html',\n\tmatchBrackets: true,\n\tindentWithTabs: true,\n\tlineWrapping : true \n});\neditor_html.on('change', function(editor, change){\n\tif(elementPreventUpdate) return;\n\telementDefinition.html = editor.getValue(); // Set HTML Data\n\tcreateElement(); // Regenerate Element\n\tsendUpdates();\n});\nelementDefinition.html = editor_html.getValue(); // Update Element Definition\n\n// CSS Editor\nvar editor_css = CodeMirror.fromTextArea(ref['element_css'], {\n\tlineNumbers: true,\n\tmode: 'text/css',\n\tmatchBrackets: true,\n\tindentWithTabs: true,\n\tlineWrapping : true  \n});\neditor_css.on('change', function(editor, change){\n\tif(elementPreventUpdate) return;\n\tif(typeof elementDefinition.css === 'undefined') elementDefinition.css = {format: 'lesscss'}\n\t\n\telementDefinition.css.style = editor.getValue();\n\tpreview_element._renderCSS(true);\n\tsendUpdates();\n});\nelementDefinition.css.style = editor_css.getValue(); // Update Element Definition\n\n// JS: Element Initialize Before\nvar editor_initialize_before_js = CodeMirror.fromTextArea(ref['element_initialize_before_js'], {\n\tlineNumbers: true,\n\tmode: 'text/javascript'\n});\neditor_initialize_before_js.on('change', function(editor, change){\n\tif(elementPreventUpdate) return;\n\telementDefinition.js['initialize-before'] = editor.getValue();\n\tcreateElement();\n\tsendUpdates();\n});\nelementDefinition.js['initialize-before'] = editor_initialize_before_js.getValue(); // Update Element Definition\n\n// JS: Element Initialize After\nvar editor_initialize_after_js = CodeMirror.fromTextArea(ref['element_initialize_after_js'], {\n\tlineNumbers: true,\n\tmode: 'text/javascript'\n});\neditor_initialize_after_js.on('change', function(editor, change){\n\tif(elementPreventUpdate) return;\n\telementDefinition.js['initialize-after'] = editor.getValue();\n\tcreateElement();\n\tsendUpdates();\n});\nelementDefinition.js['initialize-after'] = editor_initialize_after_js.getValue(); // Update Element Definition\n\n// JS: Element Set Data\nvar editor_set_data_js = CodeMirror.fromTextArea(ref['element_set_data_js'], {\n\tlineNumbers: true,\n\tmode: 'text/javascript'\n});\neditor_set_data_js.on('change', function(editor, change){\n\tif(elementPreventUpdate) return;\n\telementDefinition.js['set-data'] = editor.getValue();\n\tcreateElement();\n\tsendUpdates();\n});\nelementDefinition.js['set-data'] = editor_set_data_js.getValue(); // Update Element Definition\n\n// Initial Setup\ncreateElement();\nif(typeof elementDefinition.dependencies !== 'undefined'){\n\tbuildDependencyList(elementDefinition);\n}\n\nfunction getElementDefinition(asJSON = true){\n\t// Create JS Branch\n\tif(typeof elementDefinition.js === 'undefined') elementDefinition.js = {};\n\telementDefinition.js['initialize-before'] = editor_initialize_before_js.getValue(); // Update Element Definition\n\telementDefinition.js['initialize-after'] = editor_initialize_after_js.getValue(); // Update Element Definition\n\telementDefinition.js['set-data'] = editor_set_data_js.getValue(); // Update Element Definition (To undo Javascript Compilation)\n\t\n\t// Cleanup Element Definition\n\tif(elementDefinition.js['initialize-before'].trim() === '') delete elementDefinition.js['initialize-before'];\n\tif(elementDefinition.js['initialize-after'].trim() === '') delete elementDefinition.js['initialize-after'];\n\tif(elementDefinition.js['set-data'].trim() === '') delete elementDefinition.js['set-data'];\n\tif(Object.keys(elementDefinition.js).length === 0) delete elementDefinition.js;\n\tif(typeof elementDefinition.dependencies !== 'undefined' &&\n\t\t\tObject.keys(elementDefinition.dependencies).length === 0) delete elementDefinition.dependencies;\n\tif(typeof elementDefinition.css !== 'undefined' && typeof elementDefinition.css.style !== 'undefined' &&\n\t\t\telementDefinition.css.style.trim() === '') delete elementDefinition.css;\n\t\n\t// Return Formatted\n\treturn asJSON ? JSON.stringify(elementDefinition) : elementDefinition;\n}\n\nfunction setElementDefinition(extElementDefinition){\n\tif(typeof extElementDefinition === 'string'){\n\t\tconsole.log('Parsing from JSON String')\n\t\textElementDefinition = JSON.parse(extElementDefinition); // Parse JSON String\n\t}\n\t\n\t// Element Data to Element Editor\n\telementDefinition = extElementDefinition;\n\t\n\telementPreventUpdate = true;\n\t\n\telement_name_node.value = elementDefinition.name;\n\telement_version_node.value = elementDefinition.version;\n\t\n\t// Update Editor Elements\n  \tvar cursor = editor_html.getCursor();\n\teditor_html.setValue(elementDefinition.html);\n  \teditor_html.setCursor(cursor);\n  \n  \tcursor = editor_css.getCursor();\n\teditor_css.setValue(elementDefinition.css.style);\n  \teditor_css.setCursor(cursor);\n\t\n\tif(typeof elementDefinition.js !== 'undefined'){\n      \tcursor = editor_initialize_before_js.getCursor();\n\t  \teditor_initialize_before_js.setValue(elementDefinition.js['initialize-before'] ? elementDefinition.js['initialize-before'] : '');\n\t\teditor_initialize_before_js.setCursor(cursor);\n      \n      \tcursor = editor_initialize_after_js.getCursor();\n      \teditor_initialize_after_js.setValue(elementDefinition.js['initialize-after'] ? elementDefinition.js['initialize-after'] : '');\n\t\teditor_initialize_after_js.setCursor(cursor);\n      \n      \tcursor = editor_set_data_js.getCursor();\n      \teditor_set_data_js.setValue(elementDefinition.js['set-data'] ? elementDefinition.js['set-data'] : '');\n\t\teditor_set_data_js.setCursor(cursor);\n    }else{\n\t\teditor_initialize_before_js.setValue('');\n\t\teditor_initialize_after_js.setValue('');\n\t\teditor_set_data_js.setValue('');\n\t}\n\t\n\tbuildDependencyList(elementDefinition); // Dependency List\n\t\n\tcreateElement(); // Create Preview Element\n\t\n\tpreview_element._renderCSS(true);\n\t\n\telementPreventUpdate = false;\n}\n\nshared.getElementDefinition = getElementDefinition; // Export Functions\nshared.setElementDefinition = setElementDefinition; // Export Functions\n\nvar updateTimeout = null;\nfunction sendUpdates(){\n\tclearTimeout(updateTimeout);\n  \tupdateTimeout = setTimeout(function(){ \n    \ttriggerEvent('editor-update', getElementDefinition(false));\n    }, 1000);\n}"},"dependencies":{"js":{"codemirror":{"version":"5.36.0"},"codemirror.mode.xml":{"version":"5.36.0"},"codemirror.mode.javascript":{"version":"5.36.0"},"codemirror.mode.css":{"version":"5.36.0"},"codemirror.mode.htmlmixed":{"version":"5.36.0"}},"css":{"codemirror":{"version":"5.36.0"}}}}